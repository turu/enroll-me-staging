<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/layouts/standard.xhtml">

    <ui:define name="title">Preferences Management</ui:define>

    <ui:define name="notes">
        Attention! Changes you make to your preferences will not be saved until YOU save them. Save your changes frequently or perish!
    </ui:define>

    <ui:define name="content">
        <h:form id="form">

            <p:growl id="messages" showDetail="true" />

            <p:menubar>
                <p:menuitem value="Save" action="save" icon="ui-icon-disc"/>
                <p:menuitem value="Manage Groups" action="groups" icon="ui-icon-gear"/>
                <p:menuitem value="Reload" action="reload" icon="ui-icon-arrowrefresh-1-w"/>
                <p:menuitem value="Exit" action="exit" icon="ui-icon-close"/>
            </p:menubar>

            <p:spacer width="100%" height="10"/>

            <p:fieldset id="gapField" legend="Guidelines and Progress" collapsed="false" toggleable="true" toggleSpeed="500">

                <p:ajax event="toggle" update="barRing"/>

                <!-- This panel contains basic information about ongoing enrollment -->
                <p:panel id="guidlinesPanel" header="What to keep in mind while filling the form">
                    <h:panelGrid columns="2">
                        <h:outputLabel value="Points per term: "/>
                        <h:outputLabel value="#{scheduleController.enrollConfiguration.pointsPerTerm}"/>
                        <h:outputLabel value="Points per subject: "/>
                        <h:outputLabel value="#{scheduleController.enrollConfiguration.pointsPerSubject}"/>
                        <h:outputLabel value="Minimum points per subject: "/>
                        <h:outputLabel value="#{scheduleController.enrollConfiguration.minimumPointsPerSubject}"/>
                        <h:outputLabel value="Extra points: "/>
                        <h:outputLabel value="#{scheduleController.enrollConfiguration.additionalPoints}"/>
                    </h:panelGrid>
                </p:panel>

                <p:spacer width="100%" height="10"/>

                <div style="text-align: center;"><h3>Below you can track your progress as you distribute points:</h3></div>

                <!-- The ring is used to display statistics -->
                <p:ring id="barRing" value="#{scheduleController.ringController.progressTokens}" var="progressToken"
                        easing="swing" first="0" style="text-align: center;">
                    #{progressToken.name}
                    <p:progressBar id="pointsProgress" value="#{progressToken.progress}" labelTemplate="{value}%"
                                   displayOnly="true" />
                    #{progressToken.pointsUsed} out of #{progressToken.maxPoints}
                </p:ring>
            </p:fieldset>

            <!-- Custom schedule component based on the Schedule component -->
            <p:enrollSchedule value="#{scheduleController.eventModel}" widgetVar="schedule"
               allDaySlot="false"
               showWeekends="${scheduleController.showWeekends}"
               slotMinutes="${scheduleController.slotMinutes}"
               firstHour="${scheduleController.firstHour}"
               minTime="${scheduleController.minTime}"
               maxTime="${scheduleController.maxTime}"
               initialDate="${scheduleController.initialDate}"
               periodic="${scheduleController.periodic}"
               leftHeaderTemplate="${scheduleController.leftHeaderTemplate}"
               centerHeaderTemplate="${scheduleController.centerHeaderTemplate}"
               rightHeaderTemplate="${scheduleController.leftHeaderTemplate}"
               weekViewWidth="${scheduleController.weekViewWidth}"
               view="${scheduleController.view}"
               autoOpacity="true"
            >

                <p:ajax event="eventSelect" listener="#{scheduleController.onEventSelect}"
                        update="eventDetails" oncomplete="eventDialog.show()" />

            </p:enrollSchedule>

            <p:dialog widgetVar="eventDialog" header="Term Details" showEffect="clip" hideEffect="clip" modal="true">
                <h:panelGrid id="eventDetails" columns="2">
                    <h:outputText value="Subject's name: "/>
                    <h:outputText value="#{scheduleController.event.title}"/>
                    <h:outputText value="Start time: "/>
                    <h:outputText value="#{scheduleController.event.startDate}"/>
                    <h:outputText value="End time: "/>
                    <h:outputText value="#{scheduleController.event.endDate}"/>
                    <h:outputText value="Teacher: "/>
                    <h:outputText value="#{scheduleController.event.teacher}"/>
                    <h:outputText value="Place: "/>
                    <h:outputText value="#{scheduleController.event.place}"/>
                    <h:outputText value="Type of activity: "/>
                    <h:outputText value="#{scheduleController.event.activityType}"/>

                    <p:outputLabel value="Assigned points: " for="pointsSpinner"/>
                    <p:spinner id="pointsSpinner" title="Adjust number of points assigned to this term"
                               value="#{scheduleController.event.points}" size="2" maxlength="2"
                               min="0" max="#{scheduleController.eventPointsRange}"/>

                    <p:outputLabel value="Impossibility" for="impossibilityChkbx"/>
                    <p:selectBooleanCheckbox id="impossibilityChkbx" value="#{!scheduleController.event.possible}"
                               widgetVar="impossibilityWidget" />

                    <p:panel id="reasonPanel" header="Enter substantiation below" visible="#{}">
                        <p:inputTextarea id="reasonArea" value="#{scheduleController.reason}" rows="6" cols="33"
                               maxlength="200" counter="reasonCounter" counterTemplate="{0} characters remaining"/>

                        <h:outputText id="reasonCounter"/>
                    </p:panel>

                    <p:commandButton type="reset" value="Discard" />
                    <p:commandButton value="OK" actionListener="#{scheduleController.updateEvent}"
                        update=":form:barRing" oncomplete="schedule.update();eventDialog.hide();"/>
                </h:panelGrid>
            </p:dialog>
        </h:form>

    </ui:define>

</ui:composition>