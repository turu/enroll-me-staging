<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/layouts/standard.xhtml">

    <ui:define name="title">Preferences Management</ui:define>

    <ui:define name="notes">
    </ui:define>

    <ui:define name="content">
        <h:form id="form">

            <p:growl id="messages" showDetail="true" />

            <p:menubar>
                <p:menuitem value="Save" action="save" icon="ui-icon-disc"/>
                <p:menuitem value="Manage Groups" action="groups" icon="ui-icon-gear"/>
                <p:menuitem value="Reload" action="reload" icon="ui-icon-arrowrefresh-1-w"/>
                <p:menuitem value="Exit" action="exit" icon="ui-icon-close"/>
            </p:menubar>

            <p:spacer width="100%" height="10"/>

            <p:fieldset id="gapField" legend="Guidelines and Progress" collapsed="false" toggleable="true" toggleSpeed="500">

                <p:ajax event="toggle" update="barRing"/>

                <p:panel id="guidlinesPanel" header="What to keep in mind while filling the form">
                    <h:panelGrid columns="2">
                        <h:outputLabel value="Points per term: "/>
                        <h:outputLabel value="#{currentEnrollment.enrollConfiguration.pointsPerTerm}"/>
                        <h:outputLabel value="Points per subject: "/>
                        <h:outputLabel value="#{currentEnrollment.enrollConfiguration.pointsPerSubject}"/>
                        <h:outputLabel value="Minimum points per subject: "/>
                        <h:outputLabel value="#{currentEnrollment.enrollConfiguration.minimumPointsPerSubject}"/>
                        <h:outputLabel value="Extra points: "/>
                        <h:outputLabel value="#{currentEnrollment.enrollConfiguration.additionalPoints}"/>
                    </h:panelGrid>
                </p:panel>

                <p:spacer width="100%" height="10"/>

                <div style="text-align: center;"><h3>Below you can track your progress as you distribute points:</h3></div>

                <p:ring id="barRing" value="#{preferencesController.ringController.progressTokens}" var="progressToken"
                        easing="swing" first="0" style="text-align: center;">
                    #{progressToken.name}
                    <p:progressBar id="pointsProgress" value="#{progressToken.progress}" labelTemplate="{value}%"
                                   displayOnly="true" />
                    #{progressToken.pointsUsed} out of #{progressToken.maxPoints}
                </p:ring>
            </p:fieldset>

            <p:enrollSchedule value="#{preferencesController.scheduleController.eventModel}" widgetVar="myschedule"
               allDaySlot="false" showWeekends="false" slotMinutes="15" firstHour="8" maxTime="22"
               periodic="true" autoOpacity="true" >

                <p:ajax event="eventSelect" listener="#{preferencesController.scheduleController.onEventSelect}"
                        update="eventDetails" oncomplete="eventDialog.show()" />

            </p:enrollSchedule>

            <p:dialog widgetVar="eventDialog" header="Event Details" showEffect="clip" hideEffect="clip">
                <h:panelGrid id="eventDetails" columns="2">
                    <h:outputLabel for="title" value="Title:" />
                    <p:inputText id="title" value="#{preferencesController.scheduleController.event.title}"
                                 required="true"/>

                    <h:outputLabel for="from" value="From:" />
                    <p:inputMask id="from" value="#{preferencesController.scheduleController.event.startDate}"
                                 mask="99/99/9999 99:99">
                        <f:convertDateTime pattern="dd/MM/yyyy hh:mm" />
                    </p:inputMask>

                    <h:outputLabel for="to" value="To:" />
                    <p:inputMask id="to" value="#{preferencesController.scheduleController.event.endDate}"
                                 mask="99/99/9999 99:99">
                        <f:convertDateTime pattern="dd/MM/yyyy hh:mm" />
                    </p:inputMask>

                    <h:outputLabel for="teacher" value="Teacher:" />
                    <p:inputText id="teacher" value="#{preferencesController.scheduleController.event.teacher}" />

                    <h:outputLabel for="place" value="Place:" />
                    <p:inputText id="place" value="#{preferencesController.scheduleController.event.place}" />

                    <h:outputLabel for="points" value="Points:" />
                    <p:inputText id="points" value="#{preferencesController.scheduleController.event.points}">
                        <f:convertNumber type="number"/>
                    </p:inputText>

                    <!--temporary-->
                    <h:outputLabel for="importance" value="Importance:"/>
                    <p:inputText id="importance" value="#{preferencesController.scheduleController.event.importance}">
                        <f:convertNumber type="number"/>
                    </p:inputText>

                    <h:outputLabel for="possible" value="Possible:"/>
                    <p:selectBooleanCheckbox id="possible" value="#{preferencesController.scheduleController.event.possible}"/>

                    <p:commandButton type="reset" value="Discard" />
                    <p:commandButton value="OK" actionListener="#{preferencesController.scheduleController.updateEvent}"
                        update=":form:barRing" oncomplete="myschedule.update();eventDialog.hide();"/>
                </h:panelGrid>
            </p:dialog>
        </h:form>

    </ui:define>

</ui:composition>