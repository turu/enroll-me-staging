<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
	    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	    xsi:schemaLocation="http://www.springframework.org/schema/webflow
        http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd">

	<secured attributes="ROLE_USER, ROLE_ADMIN" match="any"/>


    <subflow-state id="manageAccount" subflow="main/account-management">
        <transition on="eventChoiceRequested" to="chooseEvent">
        </transition>
        <transition on="adminPanelRequested" to="administer">
        </transition>
    </subflow-state>

    <subflow-state id="administer" subflow="main/admin-panel">

    </subflow-state>

    <subflow-state id="chooseEvent" subflow="main/event-selection">
		<transition on="eventComplete" to="seeResults">
            <set value="currentEvent.attributes.currentEnrollment" name="flowScope.currentEnrollment"
                 type="pl.agh.enrollme.model.Enroll"/>
        </transition>
		<transition on="activeChosen" to="chooseSubjects">
            <set value="currentEvent.attributes.currentEnrollment" name="flowScope.currentEnrollment"
                 type="pl.agh.enrollme.model.Enroll"/>
        </transition>
        <transition on="eventClosed" to="seeFinalChoice">
            <set value="currentEvent.attributes.currentEnrollment" name="flowScope.currentEnrollment"
                 type="pl.agh.enrollme.model.Enroll"/>
        </transition>
	</subflow-state>
	
	<subflow-state id="chooseSubjects" subflow="main/subject-selection">
        <input name="currentEnrollment" value="currentEnrollment" required="true" type="pl.agh.enrollme.model.Enroll"/>
		<transition on="subjectsChosen" to="managePreferences"/>
        <transition on="groupsManagementRequested" to="manageUserGroups"/>
    </subflow-state>

    <subflow-state id="manageUserGroups" subflow="main/group-management">
        <input name="currentEnrollmentID" value="currentEnrollment" required="true" type="pl.agh.enrollme.model.Enroll"/>
        <transition to="chooseSubjects"/>
    </subflow-state>
	
	<subflow-state id="managePreferences" subflow="main/preferences-management">
        <input name="currentEnrollment" value="currentEnrollment" required="true"
               type="pl.agh.enrollme.model.Enroll"/>
        <transition to="flowComplete"/>
	</subflow-state>

    <subflow-state id="seeFinalChoice" subflow="main/final-choice">
        <transition to="flowComplete"/>
    </subflow-state>

	<subflow-state id="seeResults" subflow="main/results">
        <transition to="flowComplete"/>
	</subflow-state>
	
	<end-state id="flowComplete" view="externalRedirect:servletRelative:/main" />
	
	<global-transitions>
		<transition on="exit" to="flowComplete">
		</transition>
	</global-transitions>

</flow>